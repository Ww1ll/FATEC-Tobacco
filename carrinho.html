<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css"/> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- usando normalize css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
        integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Roboto:wght@100;300;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/carrinho.css">
    <link rel="shortcut icon" href="assets/imagens/fav/favicon-16x16.png" type="image/x-icon">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.js"
        integrity="sha512-6DC1eE3AWg1bgitkoaRM1lhY98PxbMIbhgYCGV107aZlyzzvaWCW1nJW2vDuYQm06hXrW0As6OGKcIaAVWnHJw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>    
    <title>Carrinho de compras</title>
    <script>
        function getCart(id){
            $.ajax({
                url: "getCart.php",
                success: function(resposta){

                    if (resposta <= 0) {
                        alert("Carrinho Vazio!");
                        window.location="produtos.html";
                        document.getElementById(id).innerHTML="";  
                        document.getElementById(id).className = "";
                    }else{
                        document.getElementById(id).innerHTML=resposta;
                        document.getElementById(id).className = "cart-value";
                    }
                }
            });
        }

        function userLogged() {
            $.ajax({
                type: "GET",
                url: "quem.php",
                success: function(resposta){
                    if(!resposta){
                        $("#user").html("Faça Login!");
                    }else{
                        $("#user").html("Bem vindo "+resposta);
                    }
                }
            })
        }
        
        function tiraDoCarrinho(codProd, acao) {
            $.ajax({
                url: `tirarDoCarrinho.php`,
                method: "POST",
                data: {
                    codProd: codProd,
                    acao: acao
                },
                success: function(resposta){
                    alert(resposta);
                    var elemento = document.getElementById("corpo");
                    elemento.innerHTML="";
                    getProd();
                    getCart('prod_qtd');
                }
            });
        }

        function getProd() {
            $('#corpo').innerHTML="";
            $.ajax({
                url: "getCartFinal.php",
                success: function (data) {                   

                    const prod = JSON.parse(data);

                    var valorSpan = document.getElementById("totalGeralCompra");
                    let soma = 0;                    

                    for (let index = 0; index < prod.length; index++) {                                                 
                        
                        let total = prod[index].preco_prod * prod[index].qtd_prod;                          

                        soma += total;
                        
                        const totalReal = total.toLocaleString("pt-BR", {
                            style: "currency",
                            currency: "BRL",
                        });                        

                        $('#corpo').append(`
                        <tr id="${prod[index].cod_prod}">
                        <td class="coluna-capa">
                            <img src="${prod[index].img_prod}" width="200px" height="200px" class="capa">
                        </td>                
                        <td> 
                            <div class="produto-car">
                                <a href="" class="nome-produto">${prod[index].desc_prod}</a>                                
                            </div>
                            <strong class="estoque">Em estoque</strong>
                            <div>
                                <label class="presente"><input type="checkbox">Presente</label>
                            </div>                            
                        </td>
                        <td colspan="2"><span class="preco-produto">${"R$ "+ prod[index].preco_prod}</span></td>
                        <td>
                            <input type="button" class="delProd" onclick="tiraDoCarrinho('${prod[index].cod_prod}','del')" value="-">
                            &nbsp;
                            <label>${prod[index].qtd_prod}</label>
                            &nbsp;
                            <input type="button" class="addProd" onclick="tiraDoCarrinho('${prod[index].cod_prod}','inc')" value="+">
                        </td>
                        <td colspan="2"><span>${totalReal}</span></td>

                    </tr>
                        `);
                    }
                    
                    valorSpan.innerHTML = "R$ " + soma;
                }
            });
            //$('#totalDaCompra').value              

        }
    </script>

</head>
<body onload="userLogged(), getCart('prod_qtd'), getProd()">    
    <script>
        $(document).ready(function () {
            $(window).bind('scroll', function () {
                let gap = 100

                if ($(window).scrollTop() > gap) {
                    $('header').addClass('active')
                } else {
                    $('header').removeClass('active')
                }                
            })
        })
    </script>
    <header>        
        <div class="container">
            <div class="toggle-btn" onclick="dropdownFunc();">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="logo">
               <a href="index.html"><img src="assets/imagens/TobaccoRebrand.png"></a> 
            </div>
            <nav class="nav" id="nav">
                <ul class="nav-links">
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="produtos.html">PRODUTOS</a></li>
                    <!-- <li><a href="#contato">CONTATO</a></li>
                    <li><a href="#sobre">SOBRE</a></li> -->
                </ul>
                <ul class="icons-nav">
                    <div class="user" id="user">
                        Bem vindo.
                    </div>
                    <li><ion-icon name="person-outline" size="large"></ion-icon></li>
                    <div class="cart-container">
                        <div class="cart-item">
                            <a href="carrinho.html"><ion-icon name="cart-outline" size="large"></ion-icon></a>
                        </div>
                        <div class="" id="prod_qtd"></div>
                    </div>
                </ul>
            </nav>

        </div>
    </header>
    
    <main class="carrinho-container">
        <h2>Carrinho de compras</h2>
        <table id="tabela-carrinho">
            <thead>
                <tr>
                    <th colspan="2"> Itens para comprar</th>
                    <th colspan="2" class="coluna-pequena">Preço</th>
                    <th class="coluna-pequena">Quantidade</th>
                    <th class="coluna-pequena">Total Individual</th>
                </tr>
            </thead>
            <!-- produto aqui -->
            <tbody id="corpo">
                    <!-- <tr id="item01">
                        <td class="coluna-capa">
                            <img src="assets/imagens/products/RapeXingu/001(2).png" width="200px" height="200px" class="capa">
                        </td>
                
                        <td> 
                            <div class="produto-car">
                                <a href="" class="nome-produto">Rape xingu</a>
                                <a href="" class="nome-marca">Rape</a>
                            </div>
                            <strong class="estoque">Em estoque</strong>
                            <div>
                                <label class="presente"><input type="checkbox">Presente</label>
                            </div>
                            <a href="" class="remover-carrinho"  onclick="remover()">Tirar do carrinho</a>
                        </td>
                        <td colspan="2"><span class="preco-produto">R$49.99</span></td>
                        <td>
                            <input type="number" value="1" min="0" max="5">
                        </td>
                    </tr> -->
                </tbody>
                <tfoot>
                    <tr>
                        <td></td>
                        <td colspan="2" class="texto-total">Total da compra</td>
                        <td colspan="3"><span class="total" id="totalGeralCompra">R$ 880.00</span></td>
                        <!-- <td>&nbsp;</td> -->
                    </tr>
                </tfoot>
        </table>
        <div class="buttons">
            <input type="submit" value="Realizar pedido" class="btn-pedido" onclick=""> <br><br>
        </div>
    </main>
    <footer>
        <div class="footer">
            <img src="assets/imagens/TOBACCO.png" alt="">
        </div>
    </footer>
    
    <script src="assets/src/components/CardProduct.js"></script>
    <script src="assets/src/dropdownFunc.js"></script>
    <!-- Materialize -->
    <!-- <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script> -->

    <!-- ionic -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>
</html>