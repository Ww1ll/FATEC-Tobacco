<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/cad-prod.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    
    <script>
        $(document).ready(function () {
            $('#cad-prod').submit(function (e) {
                e.preventDefault();
                var dados = $(e.target).serialize();
                $.ajax({
                    url: "cad_prod.php",
                    type: "POST",
                    data: dados,
                    success: function (data) {
                        if (data == "") {
                            alert('Produto Já Cadastrado!');
                        } else {
                            alert(data);
                            $('#cad-prod')[0].reset();
                            getProd();
                        }
                    }
                });
            });
        });

        // function preco(moeda) {
        //     const arredondado = +(moeda.toFixed(2));
        //     return arredondado;
        // }

        function getProd() {
            $.ajax({
                url: "get_prod.php",
                success: function (data) {
                    const prod = JSON.parse(data);
                    console.log(prod);

                    for (let index = 0; index < prod.length; index++) {
                        var valor = prod[index].preco_prod;

                        $('#produtos').append(`
                        <tr>
                            <th>${prod[index].cod_prod}</th>
                            <th><img src="${prod[index].img_prod}" alt=""></th>
                            <th><img src="${prod[index].capa_prod}" alt=""></th>
                            <th>${prod[index].desc_prod}</th>
                            <th>${prod[index].preco_prod}</th>
                            <th>${prod[index].data_cad}</th>
                            <th>${prod[index].id_resp}</th>
                        </tr> 
                        
                        <card-product image="${prod[index].img_prod}"
                                photo="${prod[index].capa_prod}" title="${prod[index].desc_prod}" price="R$ ${prod[index].preco_prod}"
                                id="${prod[index].cod_prod}"
                                onclick="">
                        </card-product>
                        `);
                        
                        $('#card-produtos').append(`
                            <card-product image="${prod[index].img_prod}"
                                photo="${prod[index].capa_prod}" title="${prod[index].desc_prod}" price="R$ ${prod[index].preco_prod}"
                                id="${prod[index].cod_prod}"
                                onclick="">
                            </card-product>
                        `);


                    }
                }
            });
        }
    </script>
    <title>Cadastro de Produtos</title>
</head>

<body onload="getProd()">
    <div class="header">
        <div id="user_log"></div>
        <div class="botoes" id="botoes">
            <input type="button" value="SAIR" class="btn sair" onclick="sair()">
        </div>
    </div>

    <div class="cad-prod">
        <form action="" method="" name="cad-prod" id="cad-prod" required>
            <div class="linha">
                <label for="">Código do produto:</label>
                <input type="text" name="cod_prod" id="cod_prod" required>
            </div>
            <div class="linha">
                <label for="">Endereço da imagem:</label>
                <input type="text" name="img_prod" id="img_prod" required>
            </div>
            <div class="linha">
                <label for="">Capa do Produto:</label>
                <input type="text" name="capa_prod" id="capa_prod" required>
            </div>
            <div class="linha">
                <label for="">Desc. do produto:</label>
                <input type="text" name="desc_prod" id="desc_prod" required>
            </div>
            <div class="linha">
                <label for="">Preço do produto:</label>
                <input type="number" min="1" step="0.01" name="preco_prod" id="preco_prod" required>
            </div>
            <div class="botoes">
                <input type="submit" value="ENVIAR">
                <input type="reset" value="LIMPAR" name="" id="">
            </div>
        </form>
    </div>

    <div class="content" id="content">
        <table id="tabela-carrinho" class="tab-prod">
            <thead>
                <tr>
                    <th>Cód. Produto</th>
                    <th>Imagem do Prduto</th>
                    <th>Capa do Prduto</th>
                    <th>Desc. Produto</th>
                    <th>Preço do Produto</th>
                    <th>Data do Cadastro</th>
                    <th>Id. Cad.</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <!-- produto aqui -->
            <tbody id="produtos">
                <tr>
                    <th></th>
                    <th><img src="" alt=""></th>
                    <th></th>
                    <th></th>
                </tr>
            </tbody>
        </table>
        
    </div>
    
</body>

</html>